<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Organised, transparent and reproducible science using R, git, and drake</title>
  <meta name="description" content="Organised, transparent and reproducible science using R, git, and drake" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Organised, transparent and reproducible science using R, git, and drake" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Organised, transparent and reproducible science using R, git, and drake" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Organised, transparent and reproducible science using R, git, and drake" />
  
  <meta name="twitter:description" content="Organised, transparent and reproducible science using R, git, and drake" />
  

<meta name="author" content="D Barneche" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  

<link rel="next" href="version-control.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script language="javascript"> 
    function toggle(id) {
        var ele = document.getElementById("toggleText" + id);
        var text = document.getElementById("displayText" + id);
        var buttonText = text.innerHTML.replace("Show ", "");
        buttonText = buttonText.replace("Hide ", "");
        if(ele.style.display == "block") {
            ele.style.display = "none";
            text.innerHTML = "Show " + buttonText;
        } else {
            ele.style.display = "block";
            text.innerHTML = "Hide " + buttonText;
        }
    } 
</script>

<script language="javascript">
    function openCode(evt, codeName, id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent" + id);
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks" + id);
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(codeName).style.display = "block";
        evt.currentTarget.className += " active";
    }
</script>

<script language="javascript">
    function hide(id){
        document.getElementById(id).style.display = "none";
    }
</script>
</script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> How to organise your project directories</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#directory-layout"><i class="fa fa-check"></i><b>1.1</b> Directory layout</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#the-general-disaster"><i class="fa fa-check"></i><b>1.1.1</b> The general disaster</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#a-nicer-solution"><i class="fa fa-check"></i><b>1.1.2</b> A niceR solution</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#treat-data-as-read-only"><i class="fa fa-check"></i><b>1.1.3</b> Treat data as read only</a></li>
<li class="chapter" data-level="1.1.4" data-path="index.html"><a href="index.html#treat-generated-output-as-disposable"><i class="fa fa-check"></i><b>1.1.4</b> Treat generated output as disposable</a></li>
<li class="chapter" data-level="1.1.5" data-path="index.html"><a href="index.html#separate-function-definition-and-application"><i class="fa fa-check"></i><b>1.1.5</b> Separate function definition and application</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#setting-up-a-project-in-rstudio"><i class="fa fa-check"></i><b>1.2</b> Setting up a project in RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="version-control.html"><a href="version-control.html"><i class="fa fa-check"></i><b>2</b> Version control</a><ul>
<li class="chapter" data-level="2.1" data-path="version-control.html"><a href="version-control.html#why-use-version-control"><i class="fa fa-check"></i><b>2.1</b> Why use version control?</a><ul>
<li class="chapter" data-level="2.1.1" data-path="version-control.html"><a href="version-control.html#you-are-already-using-version-control"><i class="fa fa-check"></i><b>2.1.1</b> You are already using version control</a></li>
<li class="chapter" data-level="2.1.2" data-path="version-control.html"><a href="version-control.html#version-control-is-not-a-back-up"><i class="fa fa-check"></i><b>2.1.2</b> Version control is not a back up</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="version-control.html"><a href="version-control.html#basic-git-configuration"><i class="fa fa-check"></i><b>2.2</b> Basic git configuration</a><ul>
<li class="chapter" data-level="2.2.1" data-path="version-control.html"><a href="version-control.html#keeping-your-email-private"><i class="fa fa-check"></i><b>2.2.1</b> Keeping your email private</a></li>
<li class="chapter" data-level="2.2.2" data-path="version-control.html"><a href="version-control.html#line-endings"><i class="fa fa-check"></i><b>2.2.2</b> Line Endings</a></li>
<li class="chapter" data-level="2.2.3" data-path="version-control.html"><a href="version-control.html#configure-your-text-editor"><i class="fa fa-check"></i><b>2.2.3</b> Configure your text editor</a></li>
<li class="chapter" data-level="2.2.4" data-path="version-control.html"><a href="version-control.html#other-editors"><i class="fa fa-check"></i><b>2.2.4</b> Other editors</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="version-control.html"><a href="version-control.html#git-basics"><i class="fa fa-check"></i><b>2.3</b> Git basics</a><ul>
<li class="chapter" data-level="2.3.1" data-path="version-control.html"><a href="version-control.html#what-goes-in-my-repository"><i class="fa fa-check"></i><b>2.3.1</b> What goes in my repository?</a></li>
<li class="chapter" data-level="2.3.2" data-path="version-control.html"><a href="version-control.html#the-commit-cycle"><i class="fa fa-check"></i><b>2.3.2</b> The commit cycle</a></li>
<li class="chapter" data-level="2.3.3" data-path="version-control.html"><a href="version-control.html#creating-a-repository"><i class="fa fa-check"></i><b>2.3.3</b> Creating a repository</a></li>
<li class="chapter" data-level="2.3.4" data-path="version-control.html"><a href="version-control.html#the-add-commit-cycle"><i class="fa fa-check"></i><b>2.3.4</b> The add-commit cycle</a></li>
<li class="chapter" data-level="2.3.5" data-path="version-control.html"><a href="version-control.html#history"><i class="fa fa-check"></i><b>2.3.5</b> History</a></li>
<li class="chapter" data-level="2.3.6" data-path="version-control.html"><a href="version-control.html#looking-at-the-history"><i class="fa fa-check"></i><b>2.3.6</b> Looking at the history</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="version-control.html"><a href="version-control.html#branching"><i class="fa fa-check"></i><b>2.4</b> Branching</a><ul>
<li class="chapter" data-level="2.4.1" data-path="version-control.html"><a href="version-control.html#what-do-branches-look-like"><i class="fa fa-check"></i><b>2.4.1</b> What do branches look like?</a></li>
<li class="chapter" data-level="2.4.2" data-path="version-control.html"><a href="version-control.html#workflows-that-use-branches"><i class="fa fa-check"></i><b>2.4.2</b> Workflows that use branches</a></li>
<li class="chapter" data-level="2.4.3" data-path="version-control.html"><a href="version-control.html#listing-branches"><i class="fa fa-check"></i><b>2.4.3</b> Listing branches</a></li>
<li class="chapter" data-level="2.4.4" data-path="version-control.html"><a href="version-control.html#creating-branches"><i class="fa fa-check"></i><b>2.4.4</b> Creating branches</a></li>
<li class="chapter" data-level="2.4.5" data-path="version-control.html"><a href="version-control.html#how-branches-grow"><i class="fa fa-check"></i><b>2.4.5</b> How branches grow</a></li>
<li class="chapter" data-level="2.4.6" data-path="version-control.html"><a href="version-control.html#merging-branches-back-together"><i class="fa fa-check"></i><b>2.4.6</b> Merging branches back together</a></li>
<li class="chapter" data-level="2.4.7" data-path="version-control.html"><a href="version-control.html#merging-when-branches-have-diverged"><i class="fa fa-check"></i><b>2.4.7</b> Merging when branches have diverged</a></li>
<li class="chapter" data-level="2.4.8" data-path="version-control.html"><a href="version-control.html#branches-and-old-versions"><i class="fa fa-check"></i><b>2.4.8</b> Branches and old versions</a></li>
<li class="chapter" data-level="2.4.9" data-path="version-control.html"><a href="version-control.html#concluding-remarks"><i class="fa fa-check"></i><b>2.4.9</b> Concluding remarks</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="version-control.html"><a href="version-control.html#further-reading-material"><i class="fa fa-check"></i><b>2.5</b> Further reading material</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lecture-slides.html"><a href="lecture-slides.html"><i class="fa fa-check"></i><b>3</b> Lecture slides</a></li>
<li class="chapter" data-level="4" data-path="resources-for-pracs.html"><a href="resources-for-pracs.html"><i class="fa fa-check"></i><b>4</b> Resources for pracs</a></li>
<li class="chapter" data-level="5" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i><b>5</b> Acknowledgements</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Organised, transparent and reproducible science using R, git, and drake</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Organised, transparent and reproducible science using R, git, and drake</h1>
<p class="author"><em>D Barneche</em></p>
</div>
<div id="how-to-organise-your-project-directories" class="section level1">
<h1><span class="header-section-number">1</span> How to organise your project directories</h1>
<p>The scientific process is naturally incremental, and many projects start life as random notes, some code, then a manuscript, and eventually everything is a bit mixed together.</p>
<!-- more -->
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
Managing your projects in a reproducible fashion doesn't just make your science reproducible, it makes your life easier.
</p>
— Vince Buffalo (<span class="citation">@vsbuffalo</span>) <a href="https://twitter.com/vsbuffalo/status/323638476153167872?ref_src=twsrc%5Etfw">April 15, 2013</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<div id="directory-layout" class="section level2">
<h2><span class="header-section-number">1.1</span> Directory layout</h2>
<div id="the-general-disaster" class="section level3">
<h3><span class="header-section-number">1.1.1</span> The general disaster</h3>
<p>Many people tend to organise their projects like this:</p>
<div class="figure">
<img src="pics/bad_layout.png" />

</div>
<p>There are many reasons why we should <em>ALWAYS</em> avoid this:</p>
<ol style="list-style-type: decimal">
<li>It is really hard to tell what version of your data is the original and what is the modified;</li>
<li>It gets really messy because it mixes files with various extensions together;</li>
<li>It probably takes you a lot of time to actually find things, and relate the correct figures to the exact code that has been used to generate it;</li>
<li>You may face professional embarrassment when sharing your project directory with a colleague or your supervisor.</li>
</ol>
</div>
<div id="a-nicer-solution" class="section level3">
<h3><span class="header-section-number">1.1.2</span> A niceR solution</h3>
<p>A good project layout helps ensure the</p>
<ul>
<li>Integrity of data</li>
<li>Portability of the project</li>
<li>Easier to pick the project back up after a break</li>
</ul>
<p>There is no one way to lay a project out. We have different approaches for different projects, reflecting the history of the project, who else is collaborating on that project.</p>
<p>Here are a couple of different ideas for laying a project out. This is the basic structure that I tend to use:</p>
<pre><code>proj/
|-- R/
|-- data/
|-- output/
|-- |-- data/
|-- |-- figures/
|-- doc/</code></pre>
<ul>
<li><p>The <code>R</code> directory contains various files with function definitions (but <em>only</em> function definitions - no code that actually runs).</p></li>
<li><p>The <code>data</code> directory contains data used in the analysis. This is treated as <em>read only</em>; in particular the R files are never allowed to write to the files in here. Depending on the project, these might be csv files, a database, and the directory itself may have subdirectories.</p></li>
<li><p>The <code>output/data</code> directory contains simulation output, processed datasets, logs, or other processed things. The <code>output/figures</code> directory contains the output figures generated by your code. Altogether the <code>output</code> directory <em>only contains generated files</em>; that is, I should always be able to delete the contents and regenerate them.</p></li>
<li><p>The <code>doc</code> directory contains the paper. I work in Markdown which is nice because it can pick up figures directly made by R. Markdown is starting to get traction among biologists. With Word you’ll have to paste them in yourself as the figures update.</p></li>
</ul>
<p>In this set up, I usually have the R script files that <em>do</em> things in the project root:</p>
<pre><code>proj/
|-- R/
|-- data/
|-- output/
|-- |-- data/
|-- |-- figures/
|-- doc/
|-- analysis.R</code></pre>
<p>For very simple projects, you might drop the R directory, perhaps replacing it with a single file <code>analysis-functions.R</code> which you <code>source</code> within the .R files that depend on the outputs.</p>
<p>The top of the analysis file usually looks something like</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(some_package)
<span class="kw">library</span>(some_other_package)
<span class="kw">source</span>(<span class="st">&quot;R/functions.R&quot;</span>)
<span class="kw">source</span>(<span class="st">&quot;R/utilities.R&quot;</span>)</code></pre></div>
<p>…followed by the code that loads the data, cleans it up, runs the analysis and generates the figures.</p>
<p>Other people have other ideas</p>
<ul>
<li><p><a href="http://www.carlboettiger.info/2012/05/06/research-workflow.html">Carl Boettiger</a> is an open science advocate who has described his <a href="http://www.carlboettiger.info/2012/05/06/research-workflow.html">layout in detail</a>. This layout uses R packages for most of the code organisation, and would be a nice approach for large projects.</p></li>
<li><p><a href="http://www.ploscompbiol.org/article/info%3Adoi%2F10.1371%2Fjournal.pcbi.1000424">This article</a> in <a href="http://www.ploscompbiol.org/">PLOS Computational Biology</a> describes a general framework.</p></li>
</ul>
</div>
<div id="treat-data-as-read-only" class="section level3">
<h3><span class="header-section-number">1.1.3</span> Treat data as read only</h3>
<p>This is probably the most important goal of setting up a project. Data are typically time consuming and/or expensive to collect. Working with them interactively (e.g., in Excel) where they can be modified means you are never sure of where the data came from, or how they have been modified. We suggest to put your data into the <code>data</code> directory and treat it as <em>read only</em>. Within your scripts you might generate derived data sets either temporarily (in an R session only) or semi-permanently (as a file in <code>output/data</code>), but the original data is always left in an untouched state.</p>
</div>
<div id="treat-generated-output-as-disposable" class="section level3">
<h3><span class="header-section-number">1.1.4</span> Treat generated output as disposable</h3>
<p>In this approach, files in directory <code>output/</code> are all generated by the scripts. A nice thing about this approach is that if the file names of generated files change (e.g, changing from <code>phylogeny.pdf</code> to <code>mammal-phylogeny.pdf</code>) files with the old names may still stick around, but because they’re in this directory you know you can always delete them. Before submitting a paper, I will go through and delete all the generated files and rerun the analysis to make sure that I can create all the analyses and figures from the data.</p>
</div>
<div id="separate-function-definition-and-application" class="section level3">
<h3><span class="header-section-number">1.1.5</span> Separate function definition and application</h3>
<p>When your project is new and shiny, the script file usually contains many lines of directly executed code. As it matures, reusable chunks get pulled into their own functions. The actual analysis scripts then become relatively short, and use the functions defined in scripts in <code>R</code>. Those scripts do nothing but define functions so that they can always be <code>source()</code>’d by the analysis scripts.</p>
</div>
</div>
<div id="setting-up-a-project-in-rstudio" class="section level2">
<h2><span class="header-section-number">1.2</span> Setting up a project in RStudio</h2>
<p>This gets rid of the #1 problem with most people’s projects face; where do you find the data. Two solutions people generally come up with are:</p>
<ol style="list-style-type: decimal">
<li>Hard code the full file name for each file you load (e.g., <code>/Users/barneche/phd/ctotpaper/data/some_data.csv</code>)</li>
<li>Set the working directory at the beginning of your script file <code>/Users/barneche/phd/ctotpaper/</code> then doing <code>read.csv(&quot;data/some_data.csv&quot;)</code></li>
</ol>
<p>The second of these is probably preferable to the first, because the “special case” part is restricted to just one line in your file. However, the project is still now quite fragile, because moving it from one place to another, you must change this file. Some examples of when you might do this:</p>
<ul>
<li>Archiving a project (moving it from a “current projects” directory to a new projects directory)</li>
<li>Giving the code to somebody else (your lab mate, collaborator, supervisor)</li>
<li>Uploading the code with your manuscript submission for review, or to <a href="http://datadryad.org/">Dryad</a> after acceptance.</li>
<li>New computer and new directory layout (especially changing platforms, or if your previous mess got too bad and you wanted to clean up).</li>
<li>Any number of new reasons</li>
</ul>
<p>The second case hints at a solution too; if we can start R in a particular directory then we can just use paths <em>relative to the project root</em> and have everything work nicely.</p>
<p>To create a project in R studio:</p>
<ul>
<li>“File”: “New Project…”</li>
<li>choose “New Directory (start a project in a brand new working directory)”.</li>
<li>Under “Project Type”, choose “New Project”.</li>
<li>In the “Directory name” type the name for the project. This might be <code>chapter_n</code> for a thesis, or something more descriptive like <code>fish_behaviour</code>.</li>
<li>In the “Create project as a subdirectory of” field select (type or browse) for the parent directory of the project. By default this is probably your home directory, but you might prefer your Documents folder.</li>
</ul>
</div>
</div>
            </section>

          </div>
        </div>
      </div>

<a href="version-control.html" class="navigation navigation-next navigation-unique" aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
